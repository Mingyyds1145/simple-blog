{% extends "base.html" %}

{% block title %}å¼€å‘ä¿¡æ¯ - {{ super() }}{% endblock %}

{% block content %}
<div class="dev-info">
    <header class="dev-header">
        <h1>ğŸ“Š åšå®¢å¼€å‘ä¿¡æ¯</h1>
        <p>ç³»ç»Ÿè¿è¡ŒçŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯</p>
    </header>

    <div class="stats-grid">
        <!-- åŸºæœ¬ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stat-card">
            <div class="stat-icon">ğŸ“</div>
            <div class="stat-content">
                <h3>æ–‡ç« æ•°é‡</h3>
                <div class="stat-number">{{ info.posts_count }}</div>
                <div class="stat-desc">å·²å‘å¸ƒçš„åšå®¢æ–‡ç« </div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">ğŸ“„</div>
            <div class="stat-content">
                <h3>é¡µé¢æ•°é‡</h3>
                <div class="stat-number">{{ info.pages_count }}</div>
                <div class="stat-desc">é™æ€é¡µé¢</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">ğŸ”„</div>
            <div class="stat-content">
                <h3>è¿è¡ŒçŠ¶æ€</h3>
                <div class="stat-status {% if info.debug_mode %}status-debug{% else %}status-production{% endif %}">
                    {{ 'è°ƒè¯•æ¨¡å¼' if info.debug_mode else 'ç”Ÿäº§æ¨¡å¼' }}
                </div>
                <div class="stat-desc">å½“å‰è¿è¡Œç¯å¢ƒ</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">ğŸ“</div>
            <div class="stat-content">
                <h3>å†…å®¹ç›®å½•</h3>
                <div class="stat-path">{{ info.content_dir }}</div>
                <div class="stat-desc">æ–‡ä»¶å­˜å‚¨ä½ç½®</div>
            </div>
        </div>
    </div>

    <!-- å›¾è¡¨åŒºåŸŸ -->
    <div class="charts-section">
        <div class="chart-row">
            <div class="chart-container">
                <h3>ğŸ“ˆ æ–‡ç« å‘å¸ƒè¶‹åŠ¿</h3>
                <canvas id="postsChart" width="400" height="200"></canvas>
            </div>
            
            <div class="chart-container">
                <h3>ğŸ·ï¸ æ ‡ç­¾åˆ†å¸ƒ</h3>
                <canvas id="tagsChart" width="400" height="200"></canvas>
            </div>
        </div>

        <div class="chart-row">
            <div class="chart-container full-width">
                <h3>ğŸ“… æœˆåº¦æ–‡ç« ç»Ÿè®¡</h3>
                <canvas id="monthlyChart" width="800" height="300"></canvas>
            </div>
        </div>
    </div>

    <!-- æœ€è¿‘æ–‡ç« åˆ—è¡¨ -->
    <div class="recent-section">
        <h3>ğŸ“‹ æœ€è¿‘æ–‡ç« </h3>
        <div class="recent-posts">
            {% for post in info.recent_posts %}
            <div class="recent-post">
                <a href="{{ url_for('show_post', slug=post.slug) }}" class="post-title">
                    {{ post.title }}
                </a>
                <div class="post-date">{{ post.date }}</div>
                {% if post.tags %}
                <div class="post-tags">
                    {% for tag in post.tags %}
                    <span class="tag mini-tag">{{ tag }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- ç³»ç»Ÿä¿¡æ¯ -->
    <div class="system-info">
        <h3>âš™ï¸ ç³»ç»Ÿä¿¡æ¯</h3>
        <div class="info-grid">
            <div class="info-item">
                <strong>æœåŠ¡å™¨æ—¶é—´:</strong> 
                <span id="serverTime">{{ info.server_time }}</span>
            </div>
            <div class="info-item">
                <strong>è¿è¡Œæ—¶é•¿:</strong> 
                <span id="uptime">è®¡ç®—ä¸­...</span>
            </div>
            <div class="info-item">
                <strong>Pythonç‰ˆæœ¬:</strong> 
                <span>{{ info.python_version }}</span>
            </div>
            <div class="info-item">
                <strong>Flaskç‰ˆæœ¬:</strong> 
                <span>{{ info.flask_version }}</span>
            </div>
        </div>
    </div>
</div>

<script>
// å›¾è¡¨æ•°æ®
const chartData = {{ info.chart_data | tojson }};

// åˆå§‹åŒ–æ–‡ç« è¶‹åŠ¿å›¾è¡¨
const postsCtx = document.getElementById('postsChart').getContext('2d');
new Chart(postsCtx, {
    type: 'line',
    data: {
        labels: chartData.months,
        datasets: [{
            label: 'æ–‡ç« æ•°é‡',
            data: chartData.posts_by_month,
            borderColor: '#007acc',
            backgroundColor: 'rgba(0, 122, 204, 0.1)',
            tension: 0.4,
            fill: true
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    stepSize: 1
                }
            }
        }
    }
});

// åˆå§‹åŒ–æ ‡ç­¾åˆ†å¸ƒå›¾è¡¨
const tagsCtx = document.getElementById('tagsChart').getContext('2d');
new Chart(tagsCtx, {
    type: 'doughnut',
    data: {
        labels: chartData.top_tags.map(t => t.tag),
        datasets: [{
            data: chartData.top_tags.map(t => t.count),
            backgroundColor: [
                '#007acc', '#28a745', '#dc3545', '#ffc107', 
                '#6f42c1', '#e83e8c', '#fd7e14', '#20c997'
            ]
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
});

// åˆå§‹åŒ–æœˆåº¦ç»Ÿè®¡å›¾è¡¨
const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
new Chart(monthlyCtx, {
    type: 'bar',
    data: {
        labels: chartData.months,
        datasets: [{
            label: 'æœˆåº¦æ–‡ç« æ•°',
            data: chartData.posts_by_month,
            backgroundColor: 'rgba(0, 122, 204, 0.7)',
            borderColor: '#007acc',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    stepSize: 1
                }
            }
        }
    }
});

// æ›´æ–°è¿è¡Œæ—¶é—´
function updateUptime() {
    const startTime = new Date('{{ info.start_time }}');
    const now = new Date();
    const diff = now - startTime;
    
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    
    document.getElementById('uptime').textContent = 
        `${days}å¤© ${hours}å°æ—¶ ${minutes}åˆ†é’Ÿ`;
}

// æ›´æ–°æœåŠ¡å™¨æ—¶é—´
function updateServerTime() {
    const now = new Date();
    document.getElementById('serverTime').textContent = 
        now.toLocaleString('zh-CN');
}

// åˆå§‹æ›´æ–°
updateUptime();
updateServerTime();

// æ¯ç§’æ›´æ–°æ—¶é—´
setInterval(updateServerTime, 1000);
setInterval(updateUptime, 60000);
</script>
{% endblock %}